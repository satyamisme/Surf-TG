{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">Welcome to Surf-TG</h1>

<section class="row text-center mb-5" aria-label="Statistics">
  <div class="col-6 col-md-3 mb-3">
    <div class="card py-3 shadow-sm">
      <h3 id="total-files">0</h3>
      <p>Total Files</p>
    </div>
  </div>
  <div class="col-6 col-md-3 mb-3">
    <div class="card py-3 shadow-sm">
      <h3 id="active-channels">0</h3>
      <p>Active Channels</p>
    </div>
  </div>
  <div class="col-6 col-md-3 mb-3">
    <div class="card py-3 shadow-sm">
      <h3 id="total-downloads">0</h3>
      <p>Total Downloads</p>
    </div>
  </div>
  <div class="col-6 col-md-3 mb-3">
    <div class="card py-3 shadow-sm">
      <h3 id="total-storage">0</h3>
      <p>Total Storage</p>
    </div>
  </div>
</section>

<section aria-label="Indexing Control">
  <button id="start-index" class="btn btn-primary me-2">Start</button>
  <button id="stop-index" class="btn btn-danger me-2" disabled>Stop</button>
  <button id="refresh-stats" class="btn btn-secondary">Refresh</button>

  <div class="progress mt-3" style="height: 30px;">
    <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  async function updateStats() {
    try {
      const response = await fetch('/api/stats/global');
      const data = await response.json();
      document.getElementById('total-files').textContent = data.total_files.toLocaleString();
      document.getElementById('active-channels').textContent = data.total_channels.toLocaleString();
      document.getElementById('total-downloads').textContent = data.total_downloads ? data.total_downloads.toLocaleString() : 'N/A';
      document.getElementById('total-storage').textContent = data.total_storage_gb + ' GB';
      document.getElementById('progress-bar').style.width = data.progress_percent ? data.progress_percent + '%' : '0%';
      document.getElementById('progress-bar').textContent = data.progress_percent + '%';
    } catch (e) {
      console.error('Error updating stats:', e);
    }
  }

  window.onload = () => {
    updateStats();
    setInterval(updateStats, 3000);
  };
</script>
{% endblock %}
